# Backend_data

This repository contains the backend for the TruBharat demo (Flask + MongoDB). It exposes REST endpoints for managing brands and products. The code uses Flask, Flask-PyMongo (PyMongo), Marshmallow for validation, and dotenv for environment configuration.

## Quick overview

- Framework: Flask
- Database: MongoDB via Flask-PyMongo
- Validation: Marshmallow
- CORS enabled
- Logging to `app.log` (file + console)

## Prerequisites

- Python 3.8+ (use a venv)
- MongoDB instance (local or remote)

## Setup

1. Create a virtual environment and activate it:

	- Windows (PowerShell):

	  ```powershell
	  python -m venv .venv
	  .\.venv\Scripts\Activate.ps1
	  ```

2. Install dependencies:

	```powershell
	pip install -r requirements.txt
	```

3. Set environment variables. Create a `.env` file in the repo root (same directory as `run.py`) with at least:

	```text
	MONGO_URI=mongodb://username:password@host:port/database
	```

	The app uses `python-dotenv`, so those variables will be loaded automatically.

## Run

Start the server (development mode is used by `run.py`):

```powershell
python run.py
```

By default the app runs on `http://0.0.0.0:5000`.

## Project structure (important files)

- `run.py` — entry point (creates app with the `development` config)
- `requirements.txt` — Python dependencies
- `app/__init__.py` — create_app, register blueprints, health route
- `app/config.py` — configuration classes (Development/Production)
- `app/extensions.py` — `mongo` (Flask-PyMongo) and `cors` initializers
- `app/modules/brands/` — controller, model, routes, schema for brands
- `app/modules/products/` — controller, model, routes, schema for products

Logs are written to `app.log` (configured in `create_app`).

## API endpoints

Base URL: http://localhost:5000

General:

- GET / -> {"message": "Flask is running successfully"}
- GET /health -> health check (attempts a DB call; returns `{"db_status": "connected"}` if OK)

Brands (Blueprint registered at `/api/brands`):

- POST /api/brands/  — create a new brand
  - Body (example): {"brand_name": "Acme", "email": "x@acme.com", "phone_number": "9876543210", "brand_logo": "http://...", "brand_description": "..."}
- GET /api/brands/   — list brands (returns a simplified list with brand_id, name, logo)
- GET /api/brands/<id> — get brand details by `brand_id`
- POST /api/brands/<id>/update — update brand (partial updates supported)

Notes: The brand schema (Marshmallow) requires `brand_name`, `email` and `phone_number`. A `brand_id` (UUID) and timestamps are generated by the model.

Products (Blueprint registered at `/api/products`):

- POST /api/products/new  — create product (body validated by ProductSchema)
- GET /api/products       — list products (supports query params: `page`, `limit`, `sort`)
- GET /api/products/<product_id> — get product details
- PUT/PATCH /api/products/<product_id> — update product
- DELETE /api/products/<product_id> — delete product
- GET /api/products/brand/<brand_id> — products by brand
- GET /api/products/category/<category> — products by category
- GET /api/products/search?q=... — search products (supports filters, pagination, sorting)
- GET /api/products/recent?limit=5 — recent products

Query & filter details for products (implemented in `ProductModel.search`):
- q: keyword search (product_name, description, category)
- page, limit: pagination
- sort: e.g. `price_asc`, `price_desc`, `newest`, `name_asc`, ...
- category, brand_id, min_price, max_price, in_stock

## Data models (high level)

Brand fields (representative):
- _id (Mongo ObjectId), brand_id (UUID), brand_name, email, phone_number
- brand_logo (URL), brand_description, documents (list of URLs)
- verification_status (Pending | Verified | Rejected)
- created_at, updated_at

Product fields (representative):
- product_id (UUID), product_name, description, price, stock
- images (list), brand_id, category, created_at, updated_at

## Dependencies

See `requirements.txt`. Key libraries:
- Flask, Flask-PyMongo, marshmallow, python-dotenv, flask-cors

## Notes & troubleshooting

- Ensure `MONGO_URI` is correct and accessible from your machine. The `/health` endpoint runs a quick DB check.
- Logs are written to `app.log` in repo root — check it when something fails.
- Brand update is routed via POST to `/api/brands/<id>/update` (note: not PUT). Product update uses PUT/PATCH.



